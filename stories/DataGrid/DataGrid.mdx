import { Canvas, Meta, Controls, Primary } from "@storybook/blocks";
import * as DataGridStories from "./DataGrid.stories";
import { T } from "../T";

<Meta of={DataGridStories} />

# DataGrid

<p
  style={{
    margin: "0 0 16px 0",
    fontSize: "18px",
    lineHeight: "28px",
    color: "#6c757d",
  }}
>
  高機能なデータグリッドコンポーネント。ソート、ページネーション、行選択などの機能を統合的に提供します。
</p>

DataGridは、Tableコンポーネントをベースに、よく使われる機能を統合した高レベルのコンポーネントです。複雑なデータテーブルを簡単に実装できます。

> **PCのみ**: このコンポーネントは機能が豊富で横幅を必要とするため、主にPC向けに設計されています。スマートフォンなどの小画面デバイスでの利用は推奨されません。

## 使用例

### 基本的な使い方

列定義とデータを渡すだけで、基本的なグリッドを表示できます。

<Primary />

<Controls />

### 行選択機能

`selection` プロップを有効にすると、チェックボックスによる行選択機能が追加されます。

<Canvas of={DataGridStories.WithSelection} />

### ソート機能

列定義で `sortable: true` を指定し、`sortConfig` と `onSort` を渡すことで、ソート機能を実装できます。

<Canvas of={DataGridStories.WithSorting} />

### ページネーション

`pagination` プロップを渡すことで、ページネーション機能を追加できます。

<Canvas of={DataGridStories.WithPagination} />

### アクション列

カスタムレンダー関数を使用して、各行にアクションボタンを配置できます。

<Canvas of={DataGridStories.WithActions} />

## 状態表示

### ローディング状態

`loading` プロップを使用して、データ読み込み中の状態を表示できます。

<Canvas of={DataGridStories.Loading} />

### 空の状態

データが空の場合、`emptyMessage` で指定したメッセージが表示されます。

<Canvas of={DataGridStories.Empty} />

## スタイルバリエーション

### ストライプ

`striped` プロップで、行を交互に色付けできます。

<Canvas of={DataGridStories.Striped} />

### ボーダー

`bordered` プロップで、テーブルにボーダーを追加できます。

<Canvas of={DataGridStories.Bordered} />

### 固定ヘッダー

`stickyHeader` と `maxHeight` を組み合わせることで、スクロール時にヘッダーを固定できます。

<Canvas of={DataGridStories.StickyHeader} />

### 列の固定 (Sticky Column)

列定義で `fixed: true` を指定すると、その列を左側に固定したまま横スクロールが可能になります。
※ 複数の列を固定する場合は、各列に `width` (数値またはpx文字列) を指定する必要があります。

<Canvas of={DataGridStories.WithFixedColumn} />

## フル機能の例

すべての機能を組み合わせた実用的な例です。

<Canvas of={DataGridStories.FullFeatured} />

## API

### DataGridProps

<table>
  <thead>
    <tr>
      <th>プロパティ</th>
      <th>型</th>
      <th>デフォルト</th>
      <th>説明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <code>columns</code>
      </td>
      <td>
        <code>DataGridColumn&lt;T&gt;[]</code>
      </td>
      <td>-</td>
      <td>列定義の配列</td>
    </tr>
    <tr>
      <td>
        <code>rows</code>
      </td>
      <td>
        <code>T[]</code>
      </td>
      <td>-</td>
      <td>データ行の配列</td>
    </tr>
    <tr>
      <td>
        <code>loading</code>
      </td>
      <td>
        <code>boolean</code>
      </td>
      <td>
        <code>false</code>
      </td>
      <td>ローディング状態</td>
    </tr>
    <tr>
      <td>
        <code>selection</code>
      </td>
      <td>
        <code>boolean</code>
      </td>
      <td>
        <code>false</code>
      </td>
      <td>行選択機能を有効化</td>
    </tr>
    <tr>
      <td>
        <code>selectedRowKeys</code>
      </td>
      <td>
        <code>React.Key[]</code>
      </td>
      <td>
        <code>[]</code>
      </td>
      <td>選択された行のキー</td>
    </tr>
    <tr>
      <td>
        <code>onSelectionChange</code>
      </td>
      <td>
        <code>{"(keys: React.Key[]) => void"}</code>
      </td>
      <td>-</td>
      <td>選択変更時のコールバック</td>
    </tr>
    <tr>
      <td>
        <code>rowKey</code>
      </td>
      <td>
        <code>{"keyof T | ((row: T) => React.Key)"}</code>
      </td>
      <td>
        <code>"id"</code>
      </td>
      <td>各行の一意なキー</td>
    </tr>
    <tr>
      <td>
        <code>sortConfig</code>
      </td>
      <td>
        <code>{'{ key: string; direction: "asc" | "desc" | "none" }'}</code>
      </td>
      <td>-</td>
      <td>現在のソート設定</td>
    </tr>
    <tr>
      <td>
        <code>onSort</code>
      </td>
      <td>
        <code>{"(key: string, direction: ...) => void"}</code>
      </td>
      <td>-</td>
      <td>ソート変更時のコールバック</td>
    </tr>
    <tr>
      <td>
        <code>pagination</code>
      </td>
      <td>
        <code>PaginationConfig</code>
      </td>
      <td>-</td>
      <td>ページネーション設定</td>
    </tr>
    <tr>
      <td>
        <code>striped</code>
      </td>
      <td>
        <code>boolean</code>
      </td>
      <td>
        <code>false</code>
      </td>
      <td>ストライプ表示</td>
    </tr>
    <tr>
      <td>
        <code>bordered</code>
      </td>
      <td>
        <code>boolean</code>
      </td>
      <td>
        <code>false</code>
      </td>
      <td>ボーダー表示</td>
    </tr>
    <tr>
      <td>
        <code>hoverable</code>
      </td>
      <td>
        <code>boolean</code>
      </td>
      <td>
        <code>true</code>
      </td>
      <td>ホバーエフェクト</td>
    </tr>
    <tr>
      <td>
        <code>stickyHeader</code>
      </td>
      <td>
        <code>boolean</code>
      </td>
      <td>
        <code>false</code>
      </td>
      <td>ヘッダーを固定</td>
    </tr>
    <tr>
      <td>
        <code>height</code>
      </td>
      <td>
        <code>string | number</code>
      </td>
      <td>-</td>
      <td>固定高さ</td>
    </tr>
    <tr>
      <td>
        <code>maxHeight</code>
      </td>
      <td>
        <code>string | number</code>
      </td>
      <td>-</td>
      <td>最大高さ</td>
    </tr>
    <tr>
      <td>
        <code>emptyMessage</code>
      </td>
      <td>
        <code>React.ReactNode</code>
      </td>
      <td>
        <code>"No data available"</code>
      </td>
      <td>空の状態のメッセージ</td>
    </tr>
  </tbody>
</table>

### DataGridColumn

<table>
  <thead>
    <tr>
      <th>プロパティ</th>
      <th>型</th>
      <th>説明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <code>key</code>
      </td>
      <td>
        <code>string</code>
      </td>
      <td>列の一意なキー</td>
    </tr>
    <tr>
      <td>
        <code>header</code>
      </td>
      <td>
        <code>React.ReactNode</code>
      </td>
      <td>ヘッダーのテキストまたは要素</td>
    </tr>
    <tr>
      <td>
        <code>width</code>
      </td>
      <td>
        <code>string | number</code>
      </td>
      <td>列の幅</td>
    </tr>
    <tr>
      <td>
        <code>sortable</code>
      </td>
      <td>
        <code>boolean</code>
      </td>
      <td>ソート可能かどうか</td>
    </tr>
    <tr>
      <td>
        <code>render</code>
      </td>
      <td>
        <code>{"(value, row, index) => React.ReactNode"}</code>
      </td>
      <td>カスタムレンダー関数</td>
    </tr>
    <tr>
      <td>
        <code>align</code>
      </td>
      <td>
        <code>{'"left" | "center" | "right"'}</code>
      </td>
      <td>テキストの配置</td>
    </tr>
    <tr>
      <td>
        <code>dataIndex</code>
      </td>
      <td>
        <code>keyof T</code>
      </td>
      <td>
        データオブジェクトのキー（デフォルトは <code>key</code>）
      </td>
    </tr>
    <tr>
      <td>
        <code>fixed</code>
      </td>
      <td>
        <code>boolean</code>
      </td>
      <td>列を左側に固定するかどうか</td>
    </tr>
  </tbody>
</table>

## 使用例（TypeScript）

```typescript
import { DataGrid, DataGridColumn } from './DataGrid';

interface User {
  id: number;
  name: string;
  email: string;
  role: string;
}

const columns: DataGridColumn<User>[] = [
  { key: 'id', header: 'ID', width: 80, sortable: true },
  { key: 'name', header: 'Name', sortable: true },
  { key: 'email', header: 'Email', sortable: true },
  {
    key: 'role',
    header: 'Role',
    render: (value) => <Badge content={value} />
  },
];

function UserTable() {
  const [users, setUsers] = useState<User[]>([]);
  const [selectedKeys, setSelectedKeys] = useState<React.Key[]>([]);

  return (
    <DataGrid
      columns={columns}
      rows={users}
      selection
      selectedRowKeys={selectedKeys}
      onSelectionChange={setSelectedKeys}
    />
  );
}
```

## TableとDataGridの使い分け

<table>
  <tbody>
    <tr>
      <td>
        <strong>Table</strong>
      </td>
      <td>より柔軟なカスタマイズが必要な場合や、シンプルな表示のみの場合</td>
    </tr>
    <tr>
      <td>
        <strong>DataGrid</strong>
      </td>
      <td>ソート、ページネーション、行選択などの機能が必要な場合</td>
    </tr>
  </tbody>
</table>

DataGridは内部でTableコンポーネントを使用しているため、Tableのすべてのスタイリング機能を継承しています。
