import { Meta } from "@storybook/blocks";
import { T } from "../stories/T";

<Meta title="Guides/Hierarchy & Composition" />

# <T k="guide_hierarchy_title" />

<p>
  <T k="guide_hierarchy_desc" />
</p>

---

## <T k="guide_hierarchy_tiers_title" />

wimui は、コンポーネントの複雑さと役割に基づいて 4 つの階層（Tiers）で設計されています。これにより、依存関係が単方向（上位から下位へ）に保たれ、メンテナンス性が向上します。

<table>
  <thead>
    <tr>
      <th>Tier</th>
      <th>概要</th>
      <th>役割</th>
      <th>主なコンポーネント</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Tier 1</strong><br/>Foundations (基盤層)</td>
      <td>他のコンポーネントにほぼ依存しない、ライブラリの最小構成要素。</td>
      <td>基本的なスタイリング、レイアウト、低レイヤーの振る舞いを提供。</td>
      <td>`Box`, `Flex`, `Stack`, `Grid`, `Icon`, `VisuallyHidden`, `Transition`, `Portal`</td>
    </tr>
    <tr>
      <td><strong>Tier 2</strong><br/>Atoms (基本要素層)</td>
      <td>単一の機能を持つ独立したコンポーネント。</td>
      <td>デザインシステム全体の統一された UI パーツを提供。</td>
      <td>`Button`, `Input`, `Checkbox`, `Radio`, `Switch`, `Badge`, `Label`, `Spinner`, `Divider`</td>
    </tr>
    <tr>
      <td><strong>Tier 3</strong><br/>Molecules (複合要素層)</td>
      <td>複数の Tier 1/2 を組み合わせ、特定の UI パターンや機能を実現するコンポーネント。</td>
      <td>複雑なインタラクションや状態管理の基盤を提供。</td>
      <td>`Popover`, `Dialog`, `Drawer`, `Tooltip`, `ScrollArea`, `Accordion`, `Tabs`, `Pagination`, `Breadcrumb`</td>
    </tr>
    <tr>
      <td><strong>Tier 4</strong><br/>Organisms (構造要素層)</td>
      <td>複数のコンポーネントをラップし、アプリケーションの特定のセクションや複雑な機能を完結させるコンポーネント。</td>
      <td>完成された UI ユニットや、ドメインに近い機能の提供。</td>
      <td>`Selectbox`, `Combobox`, `DatePicker`, `AppLayout`, `Notification`, `CommandPalette`, `Tour`</td>
    </tr>
  </tbody>
</table>

---

## <T k="guide_composition_map_title" />

主要なコンポーネントが内部的にどのコンポーネントを使用（ラップ）しているかのマッピングです。

<table>
  <thead>
    <tr>
      <th>Tier</th>
      <th>Component</th>
      <th>Composition (Uses internally)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <strong>Tier 4</strong>
      </td>
      <td>`Selectbox`</td>
      <td>`Label`, `Input`, `Icon`</td>
    </tr>
    <tr>
      <td>
        <strong>Tier 4</strong>
      </td>
      <td>`Combobox`</td>
      <td>`Input`, `Popover`, `List`</td>
    </tr>
    <tr>
      <td>
        <strong>Tier 4</strong>
      </td>
      <td>`Notification`</td>
      <td>`Card`, `Alert`, `IconButton`</td>
    </tr>
    <tr>
      <td>
        <strong>Tier 4</strong>
      </td>
      <td>`AppLayout`</td>
      <td>`Header`, `Sidebar`, `Footer`, `Drawer`</td>
    </tr>
    <tr>
      <td>
        <strong>Tier 4</strong>
      </td>
      <td>`DatePicker`</td>
      <td>`Popover`, `Calendar`, `Input`</td>
    </tr>
    <tr>
      <td>
        <strong>Tier 3</strong>
      </td>
      <td>`Dialog`</td>
      <td>`Portal`, `FocusTrap`, `Icon`</td>
    </tr>
    <tr>
      <td>
        <strong>Tier 3</strong>
      </td>
      <td>`Popover`</td>
      <td>`Icon` (Target: `Portal`, `Transition`)</td>
    </tr>
    <tr>
      <td>
        <strong>Tier 3</strong>
      </td>
      <td>`Tooltip`</td>
      <td>`Popover`</td>
    </tr>
    <tr>
      <td>
        <strong>Tier 3</strong>
      </td>
      <td>`Breadcrumb`</td>
      <td>`Link`, `Icon`</td>
    </tr>
    <tr>
      <td>
        <strong>Tier 2</strong>
      </td>
      <td>`IconButton`</td>
      <td>`Button`, `Icon`</td>
    </tr>
    <tr>
      <td>
        <strong>Tier 2</strong>
      </td>
      <td>`LinkButton`</td>
      <td>`Link`</td>
    </tr>
    <tr>
      <td>
        <strong>Tier 2</strong>
      </td>
      <td>`Alert`</td>
      <td>`Icon`</td>
    </tr>
  </tbody>
</table>

## <T k="guide_hierarchy_rules_title" />

健全な依存関係を維持するための wimui の設計ルールです。

<table>
  <thead>
    <tr>
      <th>ルール</th>
      <th>内容</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>単方向の依存</strong></td>
      <td>下位の Tier は上位の Tier に依存してはなりません（例：<code>Button</code> (Tier 2) が <code>Selectbox</code> (Tier 4) をインポートするのは禁止）。</td>
    </tr>
    <tr>
      <td><strong>同一 Tier 間の依存</strong></td>
      <td>同じ Tier 内での依存は、肥大化しない限り許容されます。</td>
    </tr>
    <tr>
      <td><strong>透過的な Props</strong></td>
      <td>ラップするコンポーネントは、可能な限り内部コンポーネントの Props を透過（Spread）させ、柔軟性を確保します。</td>
    </tr>
  </tbody>
</table>

---

## ポータルとアニメーションの原則

wimui では、DOM 管理とモーションの一貫性を保つため、以下の原則に従います。

<table>
  <thead>
    <tr>
      <th>項目</th>
      <th>ガイドライン</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>DOM管理</strong></td>
      <td>オーバーレイやモーダルなどの要素を DOM ツリーの外部に描画する場合、直接 <code>createPortal</code> を使用せず、Layer 1 の <code>Portal</code> コンポーネントを使用します。これにより、ポータル作成のロジックが統一されます。</td>
    </tr>
    <tr>
      <td><strong>アニメーション</strong></td>
      <td>コンポーネントの出現・消失に伴うアニメーションは、個別の CSS 定義ではなく Layer 1 の <code>Transition</code> コンポーネントを介して実装します。</td>
    </tr>
    <tr>
      <td><strong>共通クラスの利用</strong></td>
      <td>アニメーションの挙動は <code>transition.scss</code> で定義された共通のトランジションクラス（<code>fade</code>, <code>scale</code>, <code>slide-*</code> 等）を使用し、ライブラリ全体で一貫したユーザー体験を提供します。</td>
    </tr>
  </tbody>
</table>
