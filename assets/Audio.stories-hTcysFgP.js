const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./jsmediatags-DEqk1nKq.js","./iframe-DLp3Jz1D.js","./preload-helper-PPVm8Dsz.js","./iframe-DLVJ5iWZ.css"])))=>i.map(i=>d[i]);
import{_ as et}from"./preload-helper-PPVm8Dsz.js";import{j as a}from"./jsx-runtime-u17CrQMm.js";import{r}from"./iframe-DLp3Jz1D.js";import{c as P}from"./index-DUAuVduf.js";import{I as T}from"./Icon-DfmmhfZE.js";const Ae=({src:E,autoPlay:fe=!1,loop:Ie=!1,muted:Ne=!1,controls:qe=!0,radius:pe="none",shadow:Me=!1,border:Ve=!1,preload:Pe,caption:ge,className:Ee,style:_e,customControls:d=!1,visualizer:A=!1,showMetadata:J=!1,fadeIn:Q=!1,fadeOut:X=!1,crossfade:Y=!1,playbackRate:Fe=!1,hotkeys:be=!1,presets:Ue=!1,sleepTimer:ze=!1,...De})=>{const i=r.useMemo(()=>E?(Array.isArray(E)?E:[E]).map(t=>typeof t=="string"?{src:t}:t):[],[E]),[y,he]=r.useState(0),k=i[y]||null,[c,I]=r.useState(!1),[Z,ye]=r.useState(0),[ee,We]=r.useState(0),[m,te]=r.useState(1),[w,re]=r.useState(Ne),[f,Oe]=r.useState(Ie?1:0),[ae,Be]=r.useState(!1),[ve,we]=r.useState(""),[xe,Te]=r.useState(""),[ne,ke]=r.useState(""),[L,Le]=r.useState(1),[_,$e]=r.useState(!1),[$,se]=r.useState(null),Ge=r.useRef(null),n=r.useRef(null),p=r.useRef(null),o=r.useRef(null);r.useRef(null);const ue=r.useRef(null);r.useRef(null),r.useRef(null);const x=r.useRef(null),g=r.useRef(null),le=r.useRef(null),oe=r.useRef(null),C=r.useRef(null),N=r.useRef(null),q=r.useRef(!1),ie=typeof Q=="number"?Q:Q?1e3:0,G=typeof X=="number"?X:X?1e3:0,j=typeof Y=="number"?Y:Y?3e3:0,ce=()=>{if(o.current)return;const e=window.AudioContext||window.webkitAudioContext;if(!e)return;const t=new e;if(o.current=t,!n.current||!p.current)return;const s=t.createMediaElementSource(n.current),u=t.createGain(),v=t.createMediaElementSource(p.current),b=t.createGain(),l=t.createBiquadFilter();l.type="lowshelf",l.frequency.value=200,l.gain.value=_?10:0,ue.current=l,s.connect(l),l.connect(u),v.connect(b);const h=t.createAnalyser();h.fftSize=256,oe.current=h,u.connect(h),b.connect(h),h.connect(t.destination),g.current=u,le.current=b};r.useEffect(()=>{ue.current&&o.current&&ue.current.gain.setTargetAtTime(_?10:0,o.current.currentTime||0,.1)},[_]),r.useEffect(()=>{n.current&&(n.current.playbackRate=L)},[L]);const S=r.useCallback((e,t,s,u)=>{if(!o.current)return;const v=o.current;e.gain.cancelScheduledValues(v.currentTime),e.gain.setValueAtTime(t,v.currentTime),e.gain.linearRampToValueAtTime(s,v.currentTime+u/1e3)},[]),M=r.useCallback(()=>{if(!n.current)return;ce();const e=n.current.play();e!==void 0&&e.then(()=>{o.current&&g.current&&ie>0?S(g.current,0,m,ie):g.current&&(g.current.gain.value=m),I(!0)}).catch(t=>{console.warn("Playback prevented",t),I(!1)})},[ie,m,S]),de=r.useCallback(()=>{n.current&&(o.current&&g.current&&G>0?(S(g.current,g.current.gain.value,0,G),setTimeout(()=>{n.current?.pause(),I(!1)},G)):(n.current.pause(),I(!1)))},[G,S]),Ce=r.useCallback(()=>{if(!A||!C.current||!oe.current)return;const e=C.current,t=e.getContext("2d");if(!t)return;const s=oe.current,u=s.frequencyBinCount,v=new Uint8Array(u),b=()=>{N.current=requestAnimationFrame(b),s.getByteFrequencyData(v),t.clearRect(0,0,e.width,e.height);const l=e.width/u*2.5;let h=0;for(let F=0;F<u;F++){const V=v[F];t.fillStyle=`rgb(${V+100}, 100, 255)`,t.fillRect(h,e.height-V/2,l,V/2),h+=l+1}};b()},[A]);r.useEffect(()=>{if(c&&A)ce(),Ce(),o.current&&o.current.state==="suspended"&&o.current.resume();else if(N.current&&(cancelAnimationFrame(N.current),N.current=null),!c&&C.current){const e=C.current.getContext("2d");e&&e.clearRect(0,0,C.current.width,C.current.height)}return()=>{N.current&&cancelAnimationFrame(N.current)}},[c,A,Ce]),r.useEffect(()=>{if(!k)return;let e=k.title||"",t=k.artist||"",s=k.coverArt||"";J&&!e&&!t&&!s&&et(()=>import("./jsmediatags-DEqk1nKq.js").then(u=>u.j),__vite__mapDeps([0,1,2,3]),import.meta.url).then(u=>{(u.default||u).read(k.src,{onSuccess:b=>{const l=b.tags;if(l.title&&we(l.title),l.artist&&Te(l.artist),l.picture){const{data:h,format:F}=l.picture;let V="";h.forEach(Ze=>{V+=String.fromCharCode(Ze)});const Ye=btoa(V);ke(`data:${F};base64,${Ye}`)}},onError:b=>{console.warn("jsmediatags parse error:",b)}})}).catch(u=>{console.warn("Failed to load jsmediatags dynamically:",u)}),we(e),Te(t),ke(s),n.current&&(n.current.src=k.src,(fe||c)&&M())},[y,k,J,fe,c,M]);const je=r.useCallback(()=>{n.current&&(n.current.volume=m,n.current.muted=w),p.current&&(p.current.volume=m,p.current.muted=w)},[m,w]);r.useEffect(()=>{je()},[je]);const me=r.useCallback(()=>{ce(),c?de():M()},[c,de,M]);r.useEffect(()=>{if(!be)return;const e=t=>{if(!(t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement))switch(t.code){case"Space":t.preventDefault(),me();break;case"ArrowRight":n.current&&(n.current.currentTime+=5);break;case"ArrowLeft":n.current&&(n.current.currentTime-=5);break;case"ArrowUp":t.preventDefault(),te(s=>Math.min(1,Math.round((s+.1)*10)/10));break;case"ArrowDown":t.preventDefault(),te(s=>Math.max(0,Math.round((s-.1)*10)/10));break;case"KeyM":re(s=>!s);break}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[be,me]);const He=()=>{$!==null?(se(null),x.current&&(clearInterval(x.current),x.current=null)):(se(900),x.current=setInterval(()=>{se(e=>e===null||e<=1?(de(),x.current&&clearInterval(x.current),null):e-1)},1e3))};r.useEffect(()=>()=>{x.current&&clearInterval(x.current)},[]);const H=r.useCallback((e=1)=>{if(!i.length)return 0;if(ae&&e===1){let s=Math.floor(Math.random()*i.length);return s===y&&i.length>1&&(s=(s+1)%i.length),s}let t=y+e;return t>=i.length?t=f>=1?0:-1:t<0&&(t=f>=1?i.length-1:0),t},[y,i.length,f,ae]),K=r.useCallback((e=1)=>{n.current&&!q.current&&(n.current.pause(),n.current.currentTime=0);const t=H(e);if(t===-1){I(!1),n.current&&(n.current.currentTime=0);return}if(f===1&&e===1&&y===t){n.current&&(n.current.currentTime=0,M());return}he(t),I(!0)},[H,f,y,M]),Se=r.useCallback(e=>{!n.current||!p.current||!o.current||!g.current||!le.current||(q.current=!0,p.current.src=i[e].src,p.current.currentTime=0,p.current.play().then(()=>{const t=g.current,s=le.current;S(t,t.gain.value,0,j),S(s,0,m,j),setTimeout(()=>{n.current&&n.current.pause(),he(e),q.current=!1},j)}).catch(t=>{console.warn("Crossfade prevented",t),q.current=!1}))},[i,m,j,S]),Ke=r.useCallback(()=>{if(!n.current||q.current)return;const e=n.current.currentTime,t=n.current.duration||0;if(ye(e),j>0&&t>0&&t-e<=j/1e3&&c){const s=H(1);s!==-1&&s!==y&&Se(s)}},[j,c,y,H,Se]),Je=r.useCallback(()=>{q.current||K(1)},[K]),Qe=e=>{const t=parseFloat(e.target.value);n.current&&(n.current.currentTime=t,ye(t))},Xe=e=>{const t=parseFloat(e.target.value);te(t),t>0&&re(!1)},Re=e=>{const t=Math.floor(e/60)||0,s=Math.floor(e%60)||0;return`${t}:${s.toString().padStart(2,"0")}`};return a.jsxs("figure",{className:P("wim-audio-container",Ee),style:_e,children:[a.jsxs("div",{ref:Ge,className:P("wim-audio-inner",d&&pe!=="none"&&`wim-audio--radius-${pe}`,d&&Me&&"wim-audio--shadow",d&&Ve&&"wim-audio--border",d&&"wim-audio--custom",A&&d&&"wim-audio--has-visualizer"),children:[A&&d&&a.jsx("canvas",{ref:C,className:"wim-audio-visualizer-canvas"}),d&&J&&(ve||xe||ne)&&a.jsxs("div",{className:"wim-audio-metadata",style:{position:"relative",zIndex:2},children:[ne&&a.jsx("img",{src:ne,alt:"Cover",className:"wim-audio-cover"}),a.jsxs("div",{className:"wim-audio-info",children:[a.jsx("div",{className:"wim-audio-title",children:ve||"Unknown Title"}),a.jsx("div",{className:"wim-audio-artist",children:xe||"Unknown Artist"})]})]}),a.jsxs("div",{style:{display:d?"none":"block",width:"100%"},children:[a.jsx("audio",{ref:n,className:"wim-audio",loop:f===1&&i.length===1,muted:w,controls:!d&&qe,preload:Pe,crossOrigin:"anonymous",onTimeUpdate:Ke,onLoadedMetadata:e=>We(e.currentTarget.duration),onEnded:Je,...De}),a.jsx("audio",{ref:p,muted:w,preload:"auto",crossOrigin:"anonymous"})]}),d&&a.jsxs("div",{className:"wim-audio-custom-controls",children:[a.jsxs("div",{className:"wim-audio-time",children:[a.jsx("span",{className:"wim-audio-time__current",children:Re(Z)}),a.jsxs("div",{className:"wim-audio-progress-container",children:[a.jsx("input",{type:"range",min:"0",max:ee||0,value:Z,step:"0.1",onChange:Qe,className:"wim-audio-progress","aria-label":"Seek"}),a.jsx("div",{className:"wim-audio-progress-fill",style:{width:`${Z/(ee||1)*100}%`}})]}),a.jsx("span",{className:"wim-audio-time__total",children:Re(ee)})]}),a.jsxs("div",{className:"wim-audio-controls-row",children:[a.jsxs("div",{className:"wim-audio-controls-group",children:[a.jsxs("button",{type:"button",className:P("wim-audio-btn",f>0&&"active"),onClick:()=>Oe(e=>(e+1)%3),title:`Repeat ${f===0?"Off":f===1?"One":"All"}`,children:[a.jsx(T,{name:"RepeatIcon",size:"small"}),f===1&&a.jsx("span",{className:"wim-audio-badge",children:"1"})]}),a.jsx("button",{type:"button",className:P("wim-audio-btn",ae&&"active"),onClick:()=>Be(e=>!e),title:"Shuffle",children:a.jsx(T,{name:"ShuffleIcon",size:"small"})}),Fe&&a.jsxs("button",{type:"button",className:"wim-audio-btn wim-audio-btn--text",onClick:()=>{const e=[.5,1,1.5,2],t=e[(e.indexOf(L)+1)%e.length];Le(t)},title:"Playback Speed",children:[L,"x"]})]}),a.jsxs("div",{className:"wim-audio-controls-group",children:[Ue&&a.jsx("button",{type:"button",className:P("wim-audio-btn",_&&"active"),onClick:()=>$e(!_),title:"Bass Boost",children:a.jsx(T,{name:"ChartIcon",size:"small"})}),ze&&a.jsxs("button",{type:"button",className:P("wim-audio-btn",$!==null&&"active"),onClick:He,title:"Sleep Timer (15m)",children:[a.jsx(T,{name:"ClockIcon",size:"small"}),$!==null&&a.jsx("span",{className:"wim-audio-badge",style:{fontSize:"7px"},children:Math.ceil($/60)})]}),a.jsxs("div",{className:"wim-audio-volume-container",children:[a.jsx("button",{type:"button",className:"wim-audio-btn wim-audio-btn--volume",onClick:()=>re(e=>!e),"aria-label":w?"Unmute":"Mute",children:a.jsx(T,{name:w||m===0?"MuteIcon":"VolumeIcon",size:"small"})}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:w?0:m,onChange:Xe,className:"wim-audio-volume","aria-label":"Volume"})]})]})]}),a.jsx("div",{className:"wim-audio-controls-row",style:{justifyContent:"center",marginTop:"0.2rem"},children:a.jsxs("div",{className:"wim-audio-controls-group",children:[a.jsx("button",{type:"button",className:"wim-audio-btn",onClick:()=>K(-1),title:"Previous",children:a.jsx(T,{name:"ChevronLeftIcon",size:"small"})}),a.jsx("button",{type:"button",className:"wim-audio-btn wim-audio-btn--play",onClick:me,title:c?"Pause":"Play",children:a.jsx(T,{name:c?"PauseIcon":"PlayIcon",size:"small"})}),a.jsx("button",{type:"button",className:"wim-audio-btn",onClick:()=>K(1),title:"Next",children:a.jsx(T,{name:"ChevronRightIcon",size:"small"})})]})})]})]}),ge&&a.jsx("figcaption",{className:"wim-audio__caption",children:ge})]})};Ae.__docgenInfo={description:"",methods:[],displayName:"Audio",props:{src:{required:!1,tsType:{name:"union",raw:"string | string[] | AudioTrack | AudioTrack[]",elements:[{name:"string"},{name:"Array",elements:[{name:"string"}],raw:"string[]"},{name:"signature",type:"object",raw:`{
  src: string;
  title?: string;
  artist?: string;
  coverArt?: string;
}`,signature:{properties:[{key:"src",value:{name:"string",required:!0}},{key:"title",value:{name:"string",required:!1}},{key:"artist",value:{name:"string",required:!1}},{key:"coverArt",value:{name:"string",required:!1}}]}},{name:"Array",elements:[{name:"signature",type:"object",raw:`{
  src: string;
  title?: string;
  artist?: string;
  coverArt?: string;
}`,signature:{properties:[{key:"src",value:{name:"string",required:!0}},{key:"title",value:{name:"string",required:!1}},{key:"artist",value:{name:"string",required:!1}},{key:"coverArt",value:{name:"string",required:!1}}]}}],raw:"AudioTrack[]"}]},description:""},autoPlay:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},loop:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},muted:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},controls:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},preload:{required:!1,tsType:{name:"union",raw:'"auto" | "metadata" | "none"',elements:[{name:"literal",value:'"auto"'},{name:"literal",value:'"metadata"'},{name:"literal",value:'"none"'}]},description:""},radius:{required:!1,tsType:{name:"union",raw:'"none" | "small" | "medium" | "large" | "full"',elements:[{name:"literal",value:'"none"'},{name:"literal",value:'"small"'},{name:"literal",value:'"medium"'},{name:"literal",value:'"large"'},{name:"literal",value:'"full"'}]},description:"",defaultValue:{value:'"none"',computed:!1}},shadow:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},border:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},caption:{required:!1,tsType:{name:"string"},description:""},customControls:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},visualizer:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},showMetadata:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},fadeIn:{required:!1,tsType:{name:"union",raw:"boolean | number",elements:[{name:"boolean"},{name:"number"}]},description:"",defaultValue:{value:"false",computed:!1}},fadeOut:{required:!1,tsType:{name:"union",raw:"boolean | number",elements:[{name:"boolean"},{name:"number"}]},description:"",defaultValue:{value:"false",computed:!1}},crossfade:{required:!1,tsType:{name:"union",raw:"boolean | number",elements:[{name:"boolean"},{name:"number"}]},description:"",defaultValue:{value:"false",computed:!1}},playbackRate:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},hotkeys:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},presets:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},sleepTimer:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}};const R=""+new URL("audiosample-CblkpeR1.mp3",import.meta.url).href,tt={title:"Components/Media/Audio",component:Ae,parameters:{layout:"centered"},argTypes:{radius:{control:"select",options:["none","small","medium","large","full"]}}},U={args:{src:R,controls:!0,radius:"none"}},z={args:{src:R,controls:!0,radius:"none",caption:"オーディオサンプルのキャプション"}},D={args:{src:R,controls:!0,autoPlay:!0,muted:!0}},W={args:{src:R,customControls:!0,controls:!1,radius:"full",shadow:!0,border:!0}},O={name:"Custom Design",args:{src:{src:R,title:"Custom Player",artist:"Wim UI"},customControls:!0,showMetadata:!0,radius:"medium",shadow:!0,border:!0}},B={name:"Full Featured",args:{src:[{src:R,title:"Sample Web Audio API",artist:"Wim UI"},{src:R,title:"Track 2",artist:"Wim UI"}],customControls:!0,radius:"medium",shadow:!0,border:!0,visualizer:!0,showMetadata:!0,fadeIn:1500,fadeOut:1500,crossfade:2e3,playbackRate:!0,hotkeys:!0,presets:!0,sleepTimer:!0}};U.parameters={...U.parameters,docs:{...U.parameters?.docs,source:{originalSource:`{
  args: {
    src: audioSample,
    controls: true,
    radius: "none"
  }
}`,...U.parameters?.docs?.source}}};z.parameters={...z.parameters,docs:{...z.parameters?.docs,source:{originalSource:`{
  args: {
    src: audioSample,
    controls: true,
    radius: "none",
    caption: "オーディオサンプルのキャプション"
  }
}`,...z.parameters?.docs?.source}}};D.parameters={...D.parameters,docs:{...D.parameters?.docs,source:{originalSource:`{
  args: {
    src: audioSample,
    controls: true,
    autoPlay: true,
    muted: true
  }
}`,...D.parameters?.docs?.source}}};W.parameters={...W.parameters,docs:{...W.parameters?.docs,source:{originalSource:`{
  args: {
    src: audioSample,
    customControls: true,
    controls: false,
    radius: "full",
    shadow: true,
    border: true
  }
}`,...W.parameters?.docs?.source}}};O.parameters={...O.parameters,docs:{...O.parameters?.docs,source:{originalSource:`{
  name: "Custom Design",
  args: {
    src: {
      src: audioSample,
      title: "Custom Player",
      artist: "Wim UI"
    },
    customControls: true,
    showMetadata: true,
    radius: "medium",
    shadow: true,
    border: true
  }
}`,...O.parameters?.docs?.source}}};B.parameters={...B.parameters,docs:{...B.parameters?.docs,source:{originalSource:`{
  name: "Full Featured",
  args: {
    src: [{
      src: audioSample,
      title: "Sample Web Audio API",
      artist: "Wim UI"
    }, {
      src: audioSample,
      title: "Track 2",
      artist: "Wim UI"
    }],
    customControls: true,
    radius: "medium",
    shadow: true,
    border: true,
    visualizer: true,
    showMetadata: true,
    fadeIn: 1500,
    fadeOut: 1500,
    crossfade: 2000,
    playbackRate: true,
    hotkeys: true,
    presets: true,
    sleepTimer: true
  }
}`,...B.parameters?.docs?.source}}};const rt=["Default","WithCaption","AutoPlay","Rounded","CustomControls","FullFeatured"],ot=Object.freeze(Object.defineProperty({__proto__:null,AutoPlay:D,CustomControls:O,Default:U,FullFeatured:B,Rounded:W,WithCaption:z,__namedExportsOrder:rt,default:tt},Symbol.toStringTag,{value:"Module"}));export{ot as A,O as C,U as D,W as R};
